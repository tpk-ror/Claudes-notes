# Product Requirements Document

Claude's Notes - A monorepo for AI-assisted software development tools.

## Vision

Provide developers with powerful tools to leverage AI coding assistants through both a visual web interface and an autonomous CLI loop.

## Products

### 1. Claude's Notes (Web App)

A browser-based interface for interacting with Claude Code CLI.

#### Goals

- Provide a user-friendly chat interface for Claude Code
- Enable plan review and approval workflows
- Persist sessions and conversation history
- Support multiple concurrent sessions
- Work entirely locally without exposing API keys

#### Target Users

- Developers who prefer a visual interface over terminal
- Teams reviewing AI-generated plans before execution
- Users managing multiple Claude sessions

#### Core Features

##### Chat Interface
- Send messages to Claude through the browser
- View streaming responses in real-time
- See thinking blocks (expandable/collapsible)
- View tool calls and their results
- Markdown rendering with syntax highlighting

##### Session Management
- Create new sessions with project path
- Resume existing sessions (--resume flag)
- Switch between sessions
- View session history and costs
- Delete sessions

##### Plan Workflow
- View plans generated by Claude in plan mode
- Approve plans to allow execution
- Reject plans with feedback
- Track plan status (draft/approved/executed/archived)

##### Task Tracking
- View hierarchical task lists within plans
- Monitor task progress (pending/in_progress/completed)
- See which task is currently being executed

##### Dark Mode
- Toggle between light and dark themes
- Persist preference across sessions

#### User Stories

**Streaming Chat**
| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-1.1 | Developer | See Claude's response stream in real-time | I don't have to wait for the full response |
| US-1.2 | Developer | View Claude's thinking process | I understand how Claude arrived at the plan |
| US-1.3 | Developer | See tool calls Claude makes | I can follow what files/code Claude is examining |

**Plan Visualization**
| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-2.1 | Developer | See plans rendered as formatted markdown | Plans are easy to read and scan |
| US-2.2 | Developer | View tasks extracted into a tree structure | I can see the breakdown of work |
| US-2.3 | Developer | Track task status (pending/in-progress/done) | I know what's been completed |

**Plan Approval**
| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-3.1 | Developer | Approve a plan before execution starts | I maintain control over what gets implemented |
| US-3.2 | Developer | Reject a plan and ask for revisions | Claude can refine the approach |

**Session Management**
| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-4.1 | Developer | See a list of my previous sessions | I can find and resume past work |
| US-4.2 | Developer | Resume a previous planning session | I can continue where I left off |
| US-4.3 | Developer | Delete old sessions | I can clean up my history |

#### Non-Functional Requirements

| Category | Requirement | Target |
|----------|-------------|--------|
| Performance | Initial page load | < 2 seconds |
| Performance | Streaming token latency | < 50ms from CLI to UI |
| Performance | Message list scroll | Smooth with 1000+ messages |
| Reliability | SSE auto-reconnect | Within 3 seconds |
| Reliability | Data persistence | Zero loss on browser close |
| Usability | Theme support | Dark/light with system detection |
| Usability | Responsive layout | Minimum 1024px width |
| Security | Network binding | Localhost only (127.0.0.1) |
| Security | API key handling | None - CLI manages auth |

#### Non-Goals

- Direct API integration (always uses local CLI)
- Multi-user authentication
- Remote server deployment
- File editing UI

### 2. Ralphy CLI

An autonomous AI coding loop that processes tasks from various sources.

#### Goals

- Automate repetitive AI-assisted coding tasks
- Support multiple AI engines (Claude, Codex, Cursor, etc.)
- Enable parallel task execution
- Integrate with GitHub for issue-based workflows
- Provide verification (tests/lint) after each task

#### Target Users

- Developers automating PRD implementation
- Teams using AI for bulk code changes
- CI/CD pipelines running AI-assisted tasks

#### Core Features

##### Single Task Mode (Brownfield)
- Execute one task directly from command line
- Useful for quick fixes and additions

##### PRD Loop Mode
- Read tasks from Markdown, YAML, or GitHub Issues
- Execute tasks sequentially or in parallel
- Mark tasks complete after verification passes
- Continue until all tasks done or max iterations reached

##### Multi-Engine Support
- Claude Code (default)
- OpenCode
- Cursor Agent
- Codex
- Qwen-Code
- Factory Droid

##### Verification
- Run test command after each task
- Run lint command after each task
- Retry failed tasks with backoff
- Configurable skip options (--fast)

##### Git Integration
- Auto-commit changes after successful tasks
- Create feature branches per task
- Create pull requests automatically
- Support draft PRs

##### Parallel Execution
- Create git worktrees for concurrent work
- Run multiple AI agents simultaneously
- Configurable concurrency limit

##### Browser Automation
- Integrate with agent-browser for web testing
- Auto-detect when browser is needed
- Manual enable/disable flags

#### Non-Goals

- GUI for the CLI
- Built-in AI model serving
- Code review functionality
- Deployment automation

## Success Metrics

### Web App

- Session creation and completion rate
- Plan approval vs rejection ratio
- Average messages per session
- User retention (return visits)

### CLI

- Tasks completed per run
- Retry rate (indicates task quality)
- Time to complete PRD
- PR merge rate (for --create-pr workflows)

## Technical Constraints

### Web App

- Must work with locally installed Claude CLI
- SQLite for simple deployment (no external database)
- Server must only bind to localhost
- No API keys stored or transmitted by web app

### CLI

- Must work offline (except GitHub Issues source)
- Cross-platform binaries (macOS, Linux, Windows)
- No runtime dependencies (bundled with Bun)
- Minimal configuration required

## Release Roadmap

### V1.0 - MVP (Current)

- Streaming chat interface with real-time responses
- Plan visualization with hierarchical task trees
- Plan approval workflow (approve/reject/edit)
- Session persistence with SQLite
- Session history sidebar grouped by date
- Dark/light theme support

### V2.0 - Enhanced Diffs

- Monaco DiffEditor integration for code changes
- File tree with change indicators
- Per-file approve/reject capability
- Inline diff viewing

### V3.0 - Collaboration

- Export plans to Markdown/PDF
- Share plans via link
- Team comments on plans
- Plan versioning and history

## Open Questions

1. **CLI version compatibility** - What minimum version of Claude Code CLI should be supported?
2. **Multiple projects** - Should sessions be scoped to a project directory?
3. **Plan versioning** - Should we track revisions when plans are edited?
4. **Keyboard shortcuts** - What shortcuts should be global vs context-specific?
5. **CLI not found** - How should the app behave if Claude Code CLI is not installed?

## Future Considerations

- VS Code extension using same architecture
- Support for additional AI providers
- Team collaboration features
- Cost tracking and budgets
- Task prioritization and scheduling

## Glossary

| Term | Definition |
|------|------------|
| Session | A conversation with Claude, identified by CLI session ID |
| Plan | A proposed set of changes generated by Claude in plan mode |
| Task | A single unit of work within a plan or PRD |
| PRD | Product Requirements Document containing task list |
| Worktree | Git feature for multiple working directories from one repo |
| Engine | AI coding assistant CLI (Claude, Codex, etc.) |
